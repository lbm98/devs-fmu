diff --git a/fmusim/CMakeLists.txt b/fmusim/CMakeLists.txt
index 05d212d..aebf538 100644
--- a/fmusim/CMakeLists.txt
+++ b/fmusim/CMakeLists.txt
@@ -2,10 +2,10 @@ cmake_minimum_required (VERSION 3.17)
 
 set(CMAKE_MSVC_RUNTIME_LIBRARY MultiThreaded)
 
-set(LIBXML2_DIR  ${CMAKE_SOURCE_DIR}/ThirdParty/libxml2-2.10.3/build/install/)
-set(ZLIB_DIR     ${CMAKE_SOURCE_DIR}/ThirdParty/zlib-1.2.13/build/install/)
-set(ZLIB_SRC_DIR ${CMAKE_SOURCE_DIR}/ThirdParty/zlib-1.2.13/)
-set(CVODE_DIR    ${CMAKE_SOURCE_DIR}/ThirdParty/cvode-6.4.1/build/install/)
+set(LIBXML2_DIR  ${CMAKE_CURRENT_SOURCE_DIR}/../ThirdParty/libxml2-2.10.3/build/install/)
+set(ZLIB_DIR     ${CMAKE_CURRENT_SOURCE_DIR}/../ThirdParty/zlib-1.2.13/build/install/)
+set(ZLIB_SRC_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../ThirdParty/zlib-1.2.13/)
+set(CVODE_DIR    ${CMAKE_CURRENT_SOURCE_DIR}/../ThirdParty/cvode-6.4.1/build/install/)
 
 if (WIN32)
     set(FMUSIM_DIST_DIR ${CMAKE_BINARY_DIR}/dist/fmusim-windows/)
@@ -46,8 +46,6 @@ set(sources
   fmi1schema.h
   fmi2schema.h
   fmi3schema.h
-  fmusim.h
-  fmusim.c
   fmusim_fmi1_cs.h
   fmusim_fmi1_cs.c
   fmusim_fmi1_me.h
@@ -71,9 +69,9 @@ if (WIN32)
     set (sources ${sources} ${ZLIB_SRC_DIR}/contrib/minizip/iowin32.c)
 endif ()
 
-add_executable(fmusim ${sources})
+add_library(fmusim_lib STATIC ${sources})
 
-target_include_directories(fmusim PRIVATE
+target_include_directories(fmusim_lib PUBLIC
   .
   ../include
   ${LIBXML2_DIR}/include/libxml2
@@ -108,6 +106,11 @@ else ()
     )
 endif ()
 
-target_link_libraries(fmusim ${libraries})
+target_link_libraries(fmusim_lib ${libraries})
+
+add_executable(fmusim fmusim.c fmusim.h)
+
+target_link_libraries(fmusim fmusim_lib ${libraries})
+
+install(TARGETS fmusim fmusim_lib DESTINATION ${CMAKE_INSTALL_PREFIX})
 
-install(TARGETS fmusim DESTINATION ${CMAKE_INSTALL_PREFIX})
